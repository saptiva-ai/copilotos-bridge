🚀 Deploy to Staging
failed now in 47s
Search logs
1s
Current runner version: '2.328.0'
Runner Image Provisioner
Operating System
Runner Image
GITHUB_TOKEN Permissions
Secret source: Actions
Prepare workflow directory
Prepare all required actions
Getting action download info
Download action repository 'appleboy/ssh-action@v1.0.3' (SHA:029f5b4aeeeb58fdfe1410a5d17f967dacf36262)
Complete job name: 🚀 Deploy to Staging
7s
Build container for action use: '/home/runner/work/_actions/appleboy/ssh-action/v1.0.3/Dockerfile'.
37s
Run appleboy/ssh-action@v1.0.3
/usr/bin/docker run --name b3b07e884961161a34093b28fc9979ea03b21_f04e85 --label 7b3b07 --workdir /github/workspace --rm -e "INPUT_HOST" -e "INPUT_USERNAME" -e "INPUT_KEY" -e "INPUT_PORT" -e "INPUT_SCRIPT" -e "INPUT_PASSPHRASE" -e "INPUT_PASSWORD" -e "INPUT_SYNC" -e "INPUT_USE_INSECURE_CIPHER" -e "INPUT_CIPHER" -e "INPUT_TIMEOUT" -e "INPUT_COMMAND_TIMEOUT" -e "INPUT_KEY_PATH" -e "INPUT_FINGERPRINT" -e "INPUT_PROXY_HOST" -e "INPUT_PROXY_PORT" -e "INPUT_PROXY_USERNAME" -e "INPUT_PROXY_PASSWORD" -e "INPUT_PROXY_PASSPHRASE" -e "INPUT_PROXY_TIMEOUT" -e "INPUT_PROXY_KEY" -e "INPUT_PROXY_KEY_PATH" -e "INPUT_PROXY_FINGERPRINT" -e "INPUT_PROXY_CIPHER" -e "INPUT_PROXY_USE_INSECURE_CIPHER" -e "INPUT_SCRIPT_STOP" -e "INPUT_ENVS" -e "INPUT_ENVS_FORMAT" -e "INPUT_DEBUG" -e "INPUT_ALLENVS" -e "INPUT_REQUEST_PTY" -e "HOME" -e "GITHUB_JOB" -e "GITHUB_REF" -e "GITHUB_SHA" -e "GITHUB_REPOSITORY" -e "GITHUB_REPOSITORY_OWNER" -e "GITHUB_REPOSITORY_OWNER_ID" -e "GITHUB_RUN_ID" -e "GITHUB_RUN_NUMBER" -e "GITHUB_RETENTION_
======CMD======
# Set environment
BRANCH="develop"
ENV_NAME=$([[ "$BRANCH" == "main" ]] && echo "production" || echo "staging")
echo "🚀 Deploying $BRANCH to $ENV_NAME..."
# Check if project exists, if not clone it
if [ ! -d "/home/jf/copilotos-bridge" ]; then
  echo "📦 Cloning repository..."
  git clone https://github.com/saptiva-ai/copilotos-bridge.git /home/jf/copilotos-bridge
fi
# Navigate to project
cd /home/jf/copilotos-bridge
# Quick git update
git fetch --depth=1 origin $BRANCH 2>/dev/null || git fetch origin $BRANCH
git checkout $BRANCH
git reset --hard origin/$BRANCH
# Check docker-compose availability
if command -v docker-compose &> /dev/null; then
  COMPOSE_CMD="docker-compose"
elif command -v docker &> /dev/null && docker compose version &> /dev/null; then
  COMPOSE_CMD="docker compose"
else
  echo "❌ Neither docker-compose nor docker compose found"
  exit 1
fi
echo "🐳 Using: $COMPOSE_CMD"
# Ultra-fast build (cached layers + fast dockerfile)
echo "🏗️ Building (cached)..."
$COMPOSE_CMD -f docker-compose.fast.yml build
# Stop old containers
$COMPOSE_CMD down || true
# Start with fast compose
echo "🔄 Starting services..."
$COMPOSE_CMD -f docker-compose.fast.yml up -d
# Quick health check (30s max)
echo "🔍 Health check..."
for i in {1..6}; do
  if curl -sf http://localhost:8001/api/health >/dev/null 2>&1; then
    echo "✅ API healthy"
    break
  fi
  [[ $i -eq 6 ]] && { echo "❌ API timeout"; exit 1; }
  sleep 5
done
for i in {1..6}; do
  if curl -sf http://localhost:3000 >/dev/null 2>&1; then
    echo "✅ Web healthy"
    break
  fi
  [[ $i -eq 6 ]] && { echo "❌ Web timeout"; exit 1; }
  sleep 5
done
# Show status
echo "🎉 $ENV_NAME deployment complete!"
echo "🌐 Web: http://34.42.214.246:3000"
echo "🔌 API: http://34.42.214.246:8001"
# Show running containers
$COMPOSE_CMD ps
======END======
out: 🚀 Deploying develop to staging...
err: fatal: not a git repository (or any of the parent directories): .git
err: fatal: not a git repository (or any of the parent directories): .git
err: fatal: not a git repository (or any of the parent directories): .git
out: 🐳 Using: docker compose
out: 🏗️ Building (cached)...
err: open /home/jf/copilotos-bridge/docker-compose.fast.yml: no such file or directory
err: time="2025-09-18T04:04:34Z" level=warning msg="/home/jf/copilotos-bridge/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
err:  Container copilotos-web  Stopping
err:  Container copilotos-web  Stopped
err:  Container copilotos-web  Removing
err:  Container copilotos-web  Removed
err:  Container copilotos-api  Stopping
err:  Container copilotos-api  Stopped
err:  Container copilotos-api  Removing
err:  Container copilotos-api  Removed
err:  Container copilotos-redis  Stopping
err:  Container copilotos-mongodb  Stopping
err:  Container copilotos-redis  Stopped
err:  Container copilotos-redis  Removing
err:  Container copilotos-redis  Removed
err:  Container copilotos-mongodb  Stopped
err:  Container copilotos-mongodb  Removing
err:  Container copilotos-mongodb  Removed
err:  Network copilotos-bridge_copilotos-network  Removing
err:  Network copilotos-bridge_copilotos-network  Removed
out: 🔄 Starting services...
err: open /home/jf/copilotos-bridge/docker-compose.fast.yml: no such file or directory
out: 🔍 Health check...
out: ❌ API timeout
2025/09/18 04:05:09 Process exited with status 1
0s
Cleaning up orphan processes
